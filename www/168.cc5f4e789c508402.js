"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[168],{168:(C,P,i)=>{i.r(P),i.d(P,{LoginPageModule:()=>h});var f=i(1368),o=i(4716),t=i(2112),y=i(2508),m=i(1528),e=i(4496),_=i(4256);const r=()=>["/register"],c=[{path:"",component:(()=>{var n;class u{constructor(s,a,v){this.userService=s,this.router=a,this.alertController=v,this.user={companyName:"",password:""}}ngOnInit(){}loginUser(){var s=this;return(0,m.c)(function*(){return s.user.companyName&&s.user.password?(s.userService.loginUser(s.user).then(a=>a?(s.router.navigate(["/home"]),!0):(s.presentAlert("Error","User does not exist or password is incorrect"),!1)),!1):(yield s.presentAlert("Error","Please fill all required fields"),!1)})()}presentAlert(s,a){var v=this;return(0,m.c)(function*(){yield(yield v.alertController.create({header:s,message:a,buttons:["OK"]})).present()})()}}return(n=u).\u0275fac=function(s){return new(s||n)(e.GI1(_.u),e.GI1(y.E5),e.GI1(t.iW))},n.\u0275cmp=e.In1({type:n,selectors:[["app-login"]],decls:28,vars:4,consts:[["color","primary-contrast",1,"center_toolbar"],["src","/assets/global/BizSwapLogo.png",1,"ion-text-center","ion-margin","ion-padding"],[1,"ion-text-center","white-text"],[1,"white-text"],[1,"ion-text-start","white-text"],["color","dark",1,"ion-border-radius"],["type","email","required","",1,"",3,"ngModel","ngModelChange"],["type","password","required","",3,"ngModel","ngModelChange"],["expand","block","color","orange",1,"ion-margin",3,"click"],[1,"ion-text-center"],["color","yellow","fill","clear",3,"routerLink"],[1,""]],template:function(s,a){1&s&&(e.I0R(0,"ion-header"),e.wR5(1,"ion-toolbar",0),e.C$Y(),e.I0R(2,"ion-content"),e.wR5(3,"ion-img",1)(4,"br"),e.I0R(5,"ion-card")(6,"ion-card-header",2)(7,"ion-card-title",3),e.OEk(8,"Login"),e.C$Y()(),e.I0R(9,"ion-card-content")(10,"ion-label",4),e.OEk(11,"Username"),e.C$Y(),e.I0R(12,"ion-item",5)(13,"ion-input",6),e.iHE("ngModelChange",function(p){return e.kNx(a.user.companyName,p)||(a.user.companyName=p),p}),e.C$Y()(),e.wR5(14,"br"),e.I0R(15,"ion-label",4),e.OEk(16,"Password"),e.C$Y(),e.I0R(17,"ion-item",5)(18,"ion-input",7),e.iHE("ngModelChange",function(p){return e.kNx(a.user.password,p)||(a.user.password=p),p}),e.C$Y()()(),e.I0R(19,"ion-button",8),e.qCj("click",function(){return a.loginUser()}),e.I0R(20,"ion-label",3),e.OEk(21,"Login"),e.C$Y()()(),e.I0R(22,"ion-grid")(23,"ion-row")(24,"ion-col",9)(25,"ion-button",10)(26,"ion-label",11),e.OEk(27,"Register"),e.C$Y()()()()()()),2&s&&(e.yG2(13),e.OKB("ngModel",a.user.companyName),e.yG2(5),e.OKB("ngModel",a.user.password),e.yG2(7),e.E7m("routerLink",e.q4q(3,r)))},dependencies:[o.ue,o.eJ,o._G,t.sn,t.KC,t.Gg,t.YY,t.I7,t.Kk,t._i,t.YP,t.wB,t.Eh,t.A5,t.Yb,t.QR,t.qo,t.Md,t.qG,t.mY,y.ER],styles:[".custom-content[_ngcontent-%COMP%], .center_tool[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.login[_ngcontent-%COMP%]{width:15em}.white-text[_ngcontent-%COMP%]{color:#fff!important}"]}),u})()}];let g=(()=>{var n;class u{}return(n=u).\u0275fac=function(s){return new(s||n)},n.\u0275mod=e.a4G({type:n}),n.\u0275inj=e.s3X({imports:[y.qQ.forChild(c),y.qQ]}),u})(),h=(()=>{var n;class u{}return(n=u).\u0275fac=function(s){return new(s||n)},n.\u0275mod=e.a4G({type:n}),n.\u0275inj=e.s3X({imports:[f.MD,o.y,t.wZ,g]}),u})()},4256:(C,P,i)=>{i.d(P,{u:()=>y});var f=i(1528),o=i(8754),t=i(4496);let y=(()=>{var m;class e{constructor(r){this.firestore=r}createUser(r){var l=this;return(0,f.c)(function*(){return l.verifyIfUserExists(r).then(function(){var c=(0,f.c)(function*(g){if(g)return Promise.resolve(!1);let u="users/"+r.companyName;try{return yield(0,o.Sm)((0,o.UN)(l.firestore,u),r),localStorage.setItem("currentUser",JSON.stringify(r)),r.isCompany&&(yield(0,o.Sm)((0,o.UN)(l.firestore,"posts",r.companyName),{companyName:r.companyName,description:"",contact:"",image:"",price:0})),Promise.resolve(!0)}catch{return Promise.resolve(!1)}});return function(g){return c.apply(this,arguments)}}())})()}verifyIfUserExists(r){var l=this;return(0,f.c)(function*(){try{const c=(0,o.kt)((0,o.oV)(l.firestore,"users"),(0,o.A9)("companyName","==",r.companyName)),g=yield(0,o.uY)(c);return Promise.resolve(!g.empty)}catch{return Promise.resolve(!1)}})()}loginUser(r){var l=this;return(0,f.c)(function*(){try{const c=(0,o.kt)((0,o.oV)(l.firestore,"users"),(0,o.A9)("companyName","==",r.companyName),(0,o.A9)("password","==",r.password));if((yield(0,o.uY)(c)).empty)return Promise.resolve(!1);{let u="users/"+r.companyName;return r=(yield(0,o.i4)((0,o.UN)(l.firestore,u))).data(),localStorage.setItem("currentUser",JSON.stringify(r)),console.log("User logged in",l.getCurrentUser()),Promise.resolve(!0)}}catch{return Promise.resolve(!1)}})()}getCurrentUser(){const r=localStorage.getItem("currentUser");return r?JSON.parse(r):null}clearCurrentUser(){localStorage.removeItem("currentUser")}updateUser(r){var l=this;return(0,f.c)(function*(){const g=r.companyName;try{const n=(0,o.UN)(l.firestore,"users",g);return yield(0,o.gD)(n,{companyName:r.companyName,email:r.email,password:r.password,isCompany:r.isCompany,image:r.image}),console.log("User updated successfully:",r),localStorage.removeItem("currentUser"),localStorage.setItem("currentUser",JSON.stringify(r)),!0}catch(n){return console.error("Error updating user:",n),!1}})()}}return(m=e).\u0275fac=function(r){return new(r||m)(t.CoB(o.OI))},m.\u0275prov=t.wxM({token:m,factory:m.\u0275fac,providedIn:"root"}),e})()}}]);